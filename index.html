<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Python Terminal</title>
    <!-- Include Brython core and standard library -->
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython_stdlib.js"></script>
    <style>
        body {
            font-family: "Courier New", Courier, monospace;
            background: #282c34;
            color: #61dafb;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #61dafb;
            text-align: center;
        }

        #terminal {
            background: #1e1e1e;
            border-radius: 5px;
            padding: 10px;
            width: 800px;
            margin: 0 auto;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            height: 400px;
            overflow-y: auto;
        }

        #input-line {
            display: flex;
            align-items: center;
            color: #61dafb;
        }

        #prompt {
            margin-right: 5px;
        }

        input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: #61dafb;
            font-family: "Courier New", Courier, monospace;
            font-size: 16px;
        }

        #input-line input::placeholder {
            color: #777;
        }

        .output-line {
            color: #eee;
            margin-bottom: 5px;
            white-space: pre-wrap; /* Preserve line breaks */
        }

        .error-line {
            color: #ff6b6b;
            margin-bottom: 5px;
            white-space: pre-wrap;
        }

        .command-line {
            color: #61dafb;
            margin-bottom: 5px;
        }
    </style>
</head>
<body onload="brython()">
    <h1>Python Terminal</h1>
    <div id="terminal">
        <div class="output-line">Welcome to the Python Terminal! Type your commands below:</div>
        <div id="input-line">
            <span id="prompt">>>> </span>
            <input id="command-input" type="text" autofocus placeholder="Type a Python command and press Enter">
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        import sys
        import traceback

        terminal = document["terminal"]
        command_input = document["command-input"]

        # Capture print statements
        class StdoutCatcher:
            def __init__(self):
                self.data = ''

            def write(self, s):
                self.data += s

            def flush(self):
                pass

        def run_command(event):
            if event.key == "Enter":
                command = command_input.value.strip()
                if not command:
                    return

                # Display the entered command
                command_line = document.createElement("div")
                command_line.className = "command-line"
                command_line.textContent = f">>> {command}"
                terminal <= command_line

                # Clear the input field
                command_input.value = ""

                # Prepare stdout catcher
                stdout_catcher = StdoutCatcher()
                sys.stdout = stdout_catcher

                try:
                    # Try to compile as an expression
                    try:
                        code = compile(command, '<string>', 'eval')
                        result = eval(code, globals())
                        if result is not None:
                            output_line = document.createElement("div")
                            output_line.className = "output-line"
                            output_line.textContent = str(result)
                            terminal <= output_line
                    except SyntaxError:
                        # Not an expression, try as a statement
                        code = compile(command, '<string>', 'exec')
                        exec(code, globals())
                        # Check if there was any print output
                        if stdout_catcher.data:
                            output_line = document.createElement("div")
                            output_line.className = "output-line"
                            output_line.textContent = stdout_catcher.data
                            terminal <= output_line
                except Exception as e:
                    # Display errors
                    error_line = document.createElement("div")
                    error_line.className = "error-line"
                    error_line.textContent = ''.join(traceback.format_exception_only(type(e), e))
                    terminal <= error_line
                finally:
                    sys.stdout = sys.__stdout__

                # Scroll to the bottom
                terminal.scrollTop = terminal.scrollHeight

        # Add event listener for the input field
        command_input.bind("keypress", run_command)
    </script>
</body>
</html>
