<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Responsive Python Terminal</title>
    <!-- Include Brython core and standard library -->
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython_stdlib.js"></script>
    <style>
        body {
            font-family: "Courier New", Courier, monospace;
            background: #282c34;
            color: #61dafb;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        h1 {
            color: #61dafb;
            text-align: center;
            margin: 10px 0;
        }

        #terminal {
            background: #1e1e1e;
            border-radius: 5px;
            padding: 10px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            height: 60vh;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #terminal-content {
            display: flex;
            flex-direction: column;
        }

        .input-line {
            display: flex;
            align-items: center;
            color: #61dafb;
        }

        .prompt {
            margin-right: 5px;
            flex-shrink: 0;
        }

        .command-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: #61dafb;
            font-family: "Courier New", Courier, monospace;
            font-size: 16px;
            padding: 0;
        }

        .command-input::placeholder {
            color: #777;
        }

        .output-line {
            color: #eee;
            margin-bottom: 5px;
            white-space: pre-wrap;
        }

        .error-line {
            color: #ff6b6b;
            margin-bottom: 5px;
            white-space: pre-wrap;
        }

        .command-line {
            color: #61dafb;
            margin-bottom: 5px;
        }

        @media (max-width: 600px) {
            body {
                padding: 5px;
            }

            #terminal {
                padding: 5px;
                height: 70vh;
            }

            .command-input {
                font-size: 14px;
            }
        }
    </style>
</head>
<body onload="brython()">
    <h1>Python Terminal Emulator</h1>
    <div id="terminal">
        <div id="terminal-content">
            <div class="output-line">Welcome to the Python Terminal! Type your commands below:</div>
            <!-- Initial input line -->
            <div class="input-line">
                <span class="prompt">>>> </span>
                <input class="command-input" type="text" autofocus placeholder="">
            </div>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        import sys
        import traceback

        terminal = document["terminal-content"]

        # Initialize global namespace
        global_namespace = {}

        # Capture print statements
        class StdoutCatcher:
            def __init__(self):
                self.data = ''

            def write(self, s):
                self.data += s

            def flush(self):
                pass

        def handle_command(event):
            if event.key == "Enter":
                command_input = event.target
                command = command_input.value.strip()
                if not command:
                    # Create a new input line
                    create_new_input_line()
                    return

                # Display the entered command
                command_line = document.createElement("div")
                command_line.className = "command-line"
                command_line.textContent = f">>> {command}"
                terminal.insertBefore(command_line, command_input.parentNode)

                # Remove the old input line
                command_input.parentNode.remove()

                # Prepare stdout catcher
                stdout_catcher = StdoutCatcher()
                sys.stdout = stdout_catcher

                try:
                    # Special commands handling
                    if command == "clear":
                        # Clear the terminal content except the last input line
                        terminal.textContent = ''
                        create_new_input_line()
                        return
                    elif command == "ls":
                        # Simulate 'ls' by listing variables in global namespace
                        vars_list = ', '.join(global_namespace.keys()) or 'No variables defined.'
                        output_line = document.createElement("div")
                        output_line.className = "output-line"
                        output_line.textContent = vars_list
                        terminal.insertBefore(output_line, None)
                    elif command.startswith("pip"):
                        # Simulate 'pip' command
                        output_line = document.createElement("div")
                        output_line.className = "output-line"
                        output_line.textContent = "Error: 'pip' command is not available in this environment."
                        terminal.insertBefore(output_line, None)
                    else:
                        # Try to compile as an expression
                        try:
                            code = compile(command, '<string>', 'eval')
                            result = eval(code, global_namespace)
                            if result is not None:
                                output_line = document.createElement("div")
                                output_line.className = "output-line"
                                output_line.textContent = str(result)
                                terminal.insertBefore(output_line, None)
                        except SyntaxError:
                            # Not an expression, try as a statement
                            code = compile(command, '<string>', 'exec')
                            exec(code, global_namespace)
                            # Check if there was any print output
                            if stdout_catcher.data:
                                output_line = document.createElement("div")
                                output_line.className = "output-line"
                                output_line.textContent = stdout_catcher.data
                                terminal.insertBefore(output_line, None)
                    # Handle standard output
                    if stdout_catcher.data and command not in ("clear", "ls"):
                        output_line = document.createElement("div")
                        output_line.className = "output-line"
                        output_line.textContent = stdout_catcher.data
                        terminal.insertBefore(output_line, None)
                except Exception as e:
                    # Display errors
                    error_line = document.createElement("div")
                    error_line.className = "error-line"
                    error_line.textContent = ''.join(traceback.format_exception_only(type(e), e))
                    terminal.insertBefore(error_line, None)
                finally:
                    sys.stdout = sys.__stdout__

                # Scroll to the bottom
                terminal.scrollTop = terminal.scrollHeight

                # Create a new input line
                create_new_input_line()

        def create_new_input_line():
            # Create a new input line div
            input_line_div = document.createElement("div")
            input_line_div.className = "input-line"

            # Create prompt span
            prompt_span = document.createElement("span")
            prompt_span.className = "prompt"
            prompt_span.textContent = ">>> "

            # Create input element
            input_element = document.createElement("input")
            input_element.className = "command-input"
            input_element.type = "text"
            input_element.autofocus = True

            # Bind the event listener
            input_element.bind("keypress", handle_command)

            # Append elements
            input_line_div <= prompt_span
            input_line_div <= input_element
            terminal <= input_line_div

            # Focus on the new input
            input_element.focus()

        # Start by focusing on the first input
        initial_input = document.querySelector(".command-input")
        initial_input.bind("keypress", handle_command)
        initial_input.focus()
    </script>
</body>
</html>
